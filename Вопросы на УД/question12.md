# Вопрос 12: 

---

- ## [Расскажите, для решения какой проблемы нужны умные указатели.](#title1) 
- ## [Расскажите про отличия unique_ptr от shared_ptr.](#title2)
- ## [Расскажите для решения какой проблемы нужен weak_ptr?](#title3)

---

### <a id="title1">Расскажите, для решения какой проблемы нужны умные указатели.</a>

__ОПР:__ _Умные указатели_ - это указатели которые следят за освобождением ресурса. Построены на идиоме [__RAII__](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0_%D0%B5%D1%81%D1%82%D1%8C_%D0%B8%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F). 
          
Вспомним первую проблему где нам они понадобились:

```c++
void f(int x) {
  int* p = new int(1000);
  if (x == 0) {
    throw 1;
  }

  delete p;
}
```

Хотелось бы, чтобы p в деструкторе сам очищал память.

Используя умные указатели нам не надо будет следить за выделением и очищением памяти, что очень помогает на практике.

---

### <a id="title2">Расскажите про отличия unique_ptr от shared_ptr.</a>

__ОПР:__ _std::unique_ptr_ - это умный указатель, который владеет другим объектом и управляет им через указатель и удаляет этот объект, когда unique_ptr выходит за пределы области видимости.

Объект удаляется с использованием связанного средства удаления, когда происходит одно из следующих событий:
- управляющий объект unique_ptr уничтожен
- управляющему объекту unique_ptr присваивается другой указатель через operator= или reset().
- Объект удаляется с помощью потенциально представленного пользователем средства удаления путём вызова get_deleter()(ptr). По умолчанию средство удаления использует оператор delete, который уничтожает объект и освобождает память.

__ОПР:__ Альтернативно unique_ptr может не владеть никаким объектом, и в этом случае он называется пустым.

__ОПР:__ _std::shared_ptr_ - это умный указатель, с разделяемым владением объектом через его указатель. Несколько указателей shared_ptr могут владеть одним и тем же объектом. 
          Объект будет уничтожен и занятая им память будет освобождена в одном из следующих случаев:
- когда последний shared_ptr, владеющий указателем на объект, будет уничтожен;
- когда последнему shared_ptr, владеющему указателем на объект, будет присвоен другой указатель с помощью operator= или reset().
- Объект уничтожается с использованием выражения delete или с использованием пользовательской функции удаления объекта, переданной в конструктор shared_ptr.

_std::shared_ptr_ может разделять владение объектом и в то же время хранить указатель на другой объект. Это позволяет владеть объектом и в то же время указывать на элемент этого объекта. 
Хранимый указатель это тот, к которому обращается get(), операторы разыменования и сравнения. Управляемый указатель это тот, который будет передан функции удаления объекта, когда счётчик владения достигнет нуля.

__ОПР:__ _shared_ptr_ может не владеть ни одним объектом, в этом случае он называется пустым (пустой shared_ptr может иметь ненулевой сохранённый указатель, если был использован псевдонимный конструктор).

Указатели _unique_ptr_ и _shared_ptr_ являются "умными" указателями, которые предоставляют автоматическое управление памятью в C++.

__Отличия между unique_ptr и shared_ptr:__

1. Владение ресурсом: unique_ptr - уникальный владелец ресурса, тогда как shared_ptr может иметь несколько владельцев.
2. Копирование: unique_ptr не может быть копирован, только перемещен, тогда как shared_ptr может быть копирован и каждая копия будет считаться владельцем ресурса.
3. Размер: unique_ptr обычно занимает меньше места в памяти, так как не хранит счетчик ссылок, в отличие от shared_ptr.
4. Производительность: unique_ptr обычно быстрее, так как не требует синхронизации для подсчета ссылок.

---

### <a id="title3">Расскажите для решения какой проблемы нужен weak_ptr?</a>

_weak ptr_ хоть и назван как указатель, однако он не ведет себя как таковой. Его нельзя разименовывать!

_weak ptr_ умеет делать только две вещи:
- Отвечать на вопрос "Сколько еще шаредов указывает на объект"
- По запросу создавать новый шаред на объект

Т.е. weak ptr не владеет объектом и не учавствует в подсчете ссылок.

__ОПР:__ _weak_ptr_ используется для решения проблемы циклических ссылок, которая может возникнуть при использовании shared_ptr. Когда объекты ссылаются друг на друга с помощью shared_ptr, создается циклическая зависимость и ресурсы не будут освобождены, так как счетчик ссылок никогда не достигнет нуля.

__ОПР:__ weak_ptr позволяет получить доступ к объекту, на который ссылается shared_ptr, но не увеличивает счетчик ссылок. Если объект, на который ссылается shared_ptr, был удален, weak_ptr будет содержать нулевой указатель. Это позволяет избежать циклических зависимостей и правильно управлять памятью.

---
